#ifndef COMMON_H
#define COMMON_H

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/ipc.h>
#include <sys/msg.h>
#include <sys/sem.h>
#include <sys/shm.h>
#include <fcntl.h>
#include <string.h>
#include <time.h>
#include <errno.h>
#include <string.h>
#include <sys/wait.h>
#include <sys/stat.h>
#include <signal.h>

#define N  2// Taille du tampon 
#define M1 3 // Nombre de malades critiques
#define N1 3 // Types d'organes critiques
#define M2 4 // Nombre de malades non-critiques
#define N2 4 // Types d'organes non-critiques 

#define FTOK_PATH "/tmp/tp2key"

struct req_msg {
    long mtype;
    int num_malade;
    int num_organe;
};

struct imp_msg {
    long mtype;
    int type_malade; // 1 critical, 2 non-critical
    int num_malade;
    int num_organe;
};

struct tube_msg {
    int type_malade;
    int num_malade;
    int num_organe;
};

// Structure d'un organe
struct Organe {
    int type_malade;    
    int num_malade;     
    int num_organe;     
};

// Structure du tampon (memoire partagee)
struct Tampon {
    int head;           // indice de lecture
    int tail;           // indice d'écriture
    int count;          // nombre d'éléments dans le tampon
    struct Organe organes[N];  // tableau d'organes
};

// ------------------- SEMAPHORES -------------------
#define MUTEX_SEM 0   // Semaphore pour exclusion mutuelle
#define EMPTY_SEM 1   // Semaphore pour places vides (initialise a N)

void P(int semid, short semnum) {
    struct sembuf op = {semnum, -1, 0};
    semop(semid, &op, 1);
}

void V(int semid, short semnum) {
    struct sembuf op = {semnum, 1, 0};
    semop(semid, &op, 1);
}

#endif